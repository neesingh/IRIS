function [radius,meanZ,XI,F] = RadialAverage(Z,X,Y)% RadialAverage - Average Z(x,y) over theta in polar coordinates to produce%  a function of radius only.%% Use: [radius, meanZ] = RadialAverage(X,Y,Z)%% Input args:%	X, Y = meshgrid support for Z%	Z = data values to be averaged%% Output variables:%	radius = col vector of radius values contained in meshgrid (X,Y); NOT uniformly spaced%	meanZ = col vector of average Z-values at each discrete radius value in vector "radius"%	XI = uniformly spaced radius vector for interpolating results%   F = radial average interpolated onto sampling points XI%% Method is to convert the meshgrid to polar coordinates.  For each radius%  value in the polar mesh there will be a number of Z-values corresponding%  to different theta values.  Average these to integrate over theta.%  Result is Z(R), a 1-dimensional function of radius.  Note that R-values%  are NOT equally spaced in the radial average.%% May-01. Modified XY2Radial to permit summing over 180deg or 360deg.  % In general, OTFs have hermitian symmetry.  Therefore, a radial average of OTF will%  equal the radial average of RE(OTF) since the IM(OTF) will sum to zero.  Thus, the %  imaginary part of OTF will make no contribution to rOTF.  The rOTF will therefore%  be entirely real and even symmetric because RE(Hermitian function) is even symmetric.% To the contrary, the imag part of OTF does contribute to rMTF because MTF=RE(OTF)^2+IM(OTF)^2.% Again, the MTF will be real and even symmetric. Thus rMTF and rOTF are both real%  and have even symmetry so in principle we only need to sum over 0-180 deg to%  compute rMTF.  However, Xin's program assumes the calculation is over full 360deg.%% see also testRadialAverage, XY2Radial%% LNT 22-May-01%% © 2001 Larry Thibos, Indiana University[r,z]=XY2Radial(Z,X,Y);D=diff(r);		% locate all the points with the same R-valueF=find(D~=0);	%  ending indices n=length(F);G=[1; F+1];	G=G(1:n);	% beginning indicesfor j=1:n%	G(j),F(j) % diagnostic	M(j)=mean( z(G(j):F(j)) );endradius=r(F);	% the radius values representedmeanZ=M';		% mean of Z-values at those radii% interpolate the results onto a uniformly-spaced radial vectorXI = [radius(1): radius(2)-radius(1): radius(length(radius))]';F=interp1q(radius,meanZ,XI);% diagnostic% disp('Radial Average sends a message')% figure; plot(radius, meanZ)