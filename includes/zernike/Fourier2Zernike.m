function z=Fourier2Zernike(F,a)%Fourier2Zernike  -Convert spectacle Rx in Fourier form to normalized Zernike vector%% Usage:  z=Fourier2Zernike(F,a)%% Input args:	%	F = Fourier col vector (M; J0; J45) or matrix of col vectors%	a = pupil radius (scalar) or vector of radius values [mm] (verified)%%	Units: if the Fourier vector of dioptric powers is in diopters%		 and pupil radius is in mm then Zernike coefficients are in microns.%% Output variables:%	z = col vector of normalized Zernike coefficients (NOT sparse)%		or matrix of col vectors%% Method: %   Basis for conversion is outlined in section 3.3 of draft chapter%   of Handbook of Visual Optics by L.N. Thibos. Basic idea is to relate%   slope of the wave aberration function to the longitudinal ray %   aberration of a marginal ray.  Differentiating the second order%   Zernike polynomials leads to a simple expression which is directly%   comparable with the power profile of a sphero-cylinder lens.  Comparing%   corresponding terms leads to simple linear relationships between %   Zernike coefficients and Fourier coefficients.%% Sign convention:%   Optometric prescriptions are specified in terms of the power of that%   spectacle lens required to correct the eye's refractive error.  For%   example, a myopic eye with 1 diopter of excessive power would have %   a refractive error of -1 diopter.  The wavefront emerging from such an%	eye would be converging to a point at 1 m.  Thus, an input vector F=[-1,0,0] %   to Fourier2Zernike will return a positive aberration function, W(x,y) > 0 %	for all (x,y) other than the origin, as expected for a converging wavefront.%   Note the inclusion of piston (Z(1)) term to ensure W(0,0)=0 as required%   by definition of the wave aberration function.%% Fourier form of spectacle presecription (Rx) is given in:%  	 L. N. Thibos, W. Wheeler, and D. G. Horner, %  	"Power vectors: an application of Fourier analysis to the%	 description and statistical analysis of refractive error" %	 Optom. Vis. Sci. 74, 367-375 (1997).%% See also:  ZNORM, ZERNIKE2FOURIER, FOURIER2SPEX, SPEX2FOURIER%% LNT 1-Apr-99% LNT 16-Nov-99.  Verified this function is consistent with VSIA standards. No changes% LNT 10Jul08. Vectorized routine to handle vector of pupil radius values.% © 1999 Larry Thibos, Indiana UniversityM = F(1,:);				% first row is vector of mean sphere valuesJ0 = F(2,:);			% second row is vector of J0 valuesJ45 = F(3,:);			% third row is vector of J45 values[rows,cols]=size(F);	% F is a 3xN matrixZ = zeros(6,cols);		% allocate spaceZ(5,:) = -M.*a.*a/4;		% assert the equality of corresponding termsZ(6,:) = -J0.*a.*a/2;		% normal (cosine) JCCZ(4,:) = -J45.*a.*a/2;	% oblique (sine) JCCZ(1,:) = Z(5,:);		% add piston term to force W(0,0) = 0modes = 1:6;			% create a vector of mode numbersn = ones(1, cols);Zn = Znorm(modes')*n;	% matrix of repeated columns of normalization vectorz = Z ./ Zn;			% normalize the Zernike coefficients% end of function Fourier2Zernike