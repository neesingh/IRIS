function y = pf2psf(x,pad)%% pf2psf - pupil function to point-spread function% When size(x) = 16x16 and pad=8, then size(y) = 84x84% LNT 30-Oct-02.  Written to be called from a blkproc() function (see Zc2SHimage).  %  Some things are hard coded until I can figure out how to pass extra args% LNT 22JUL tidy up% LNT 13July2010 Add diagnostic graphics% LNT 30May2011. Make forcing PSFs to have unit volume optional (so apodization works)% LNT 09Jun2011. Confirmed that increasing the size of x (i.e. number of% wavefront samples across the lenslet) increases the size of PSF without% changing the resolution of the PSF (i.e. distance between discrete points)forceVolume = true;[r,c] = size(x);                        % x is 16x16%pad = 8;								% pad pupil function increases resolution of the computed PSF to 8*[16,16] = 128x128	ASF = ifft2(x,pad*r,pad*c); 			% amplitude spread function  (not centered)PSF = ASF.*conj(ASF);					% intensity spread function (not centered)if forceVolume    PSFvol = sum(sum(PSF));				% pseudo-volume under PSF (don't multiply by elemental area of base)    if PSFvol == 0, PSFvol = 1; end		% trap PSFs that contain no light    PSF = PSF/PSFvol;                   % force all PSFs to sum to one = central ordinate of OTFendPSF = fftshift(PSF);                    % center the resulty = PSF(23:106,23:106);                 % y is 84x84% extract the central 400 microns of the image.  Middle point = [43,43].                						% 400/4.7475 = 84 cells.  128-84=44 to trim; split this in half to center the extract										% where 4.7474 microns = deltaX = cell size										% 128x128 array is 610 microns wideif false  % diagnostic graphics    figure; subplot(1,2,1), imagesc(angle(x)), title('WFE')    colormap 'gray', axis square    subplot(1,2,2), imagesc(y), title('PSF'),colormap 'gray', axis squareend										